---
title: Solucion de problemas de conexion Socket‚Äú
description: Guia para resolver problemas de conexion en Socket.IO como desconexiones y errores de WebSocket o CORS
href: /solucion-problemas-conexion-socketio
subtitle: Problemas de conexion Socket.IO
---

Socket.IO es clave para aplicaciones en tiempo real, pero pueden surgir problemas como conexiones fallidas, desconexiones inesperadas o el uso exclusivo de HTTP long-polling. Esta gu√≠a detalla c√≥mo diagnosticar y resolver estos problemas con pasos pr√°cticos y ejemplos de c√≥digo, optimizada para desarrolladores que buscan soluciones r√°pidas.

**Consejo**: Usa la [Interfaz de Administraci√≥n de Socket.IO](https://socket.io/docs/v4/admin-ui/) para obtener informaci√≥n adicional sobre el estado de tu despliegue.

## Problema El socket no puede conectar

Si el cliente no establece conexi√≥n con el servidor, sigue estos pasos para diagnosticar el problema.

### Pasos para diagnosticar

#### En el cliente

Escucha el evento `connect_error` para obtener detalles:

```go:js
socket.on("connect_error", (err) => {
  console.log("Error:", err.message); // Ejemplo: "xhr poll error"
  console.log("Descripci√≥n:", err.description); // C√≥digo de estado HTTP
  console.log("Contexto:", err.context); // Objeto XMLHttpRequest
});
```

#### En el servidor

Escucha el evento `connection_error` para m√°s informaci√≥n:

```go:js
io.engine.on("connection_error", (err) => {
  console.log("Solicitud:", err.req); // Objeto de solicitud
  console.log("C√≥digo:", err.code); // Ejemplo: 1
  console.log("Mensaje:", err.message); // Ejemplo: "Session ID unknown"
  console.log("Contexto:", err.context); // Contexto adicional
});
```

### Codigos de error comunes

| C√≥digo | Mensaje                      | Posible causa                                                                        |
| ------ | ---------------------------- | ------------------------------------------------------------------------------------ |
| 0      | Transport unknown            | Error raro, indica problemas internos.                                               |
| 1      | Session ID unknown           | Sesiones pegajosas (_sticky sessions_) no habilitadas en despliegues multi-servidor. |
| 2      | Bad handshake method         | Error raro, indica problemas en el protocolo.                                        |
| 3      | Bad request                  | Proxy no reenv√≠a correctamente los encabezados WebSocket.                            |
| 4      | Forbidden                    | Conexi√≥n denegada por el m√©todo `allowRequest`.                                      |
| 5      | Unsupported protocol version | Cliente y servidor usan versiones incompatibles.                                     |

### Posibles causas y soluciones

#### Intentas conectar a un servidor WebSocket puro

Socket.IO no es una implementaci√≥n directa de WebSocket. Este c√≥digo fallar√°:

```go:js
const socket = io("ws://echo.websocket.org", { transports: ["websocket"] });
```

**Soluci√≥n**: Aseg√∫rate de conectar a un servidor Socket.IO. Verifica la URL con:

```go:bash
curl "<URL-del-servidor>/socket.io/?EIO=4&transport=polling"
```

Deber√≠as recibir:

```go:json
0{"sid":"Lbo5JLzTotvW3g2LAAAA","upgrades":["websocket"],"pingInterval":25000,"pingTimeout":20000}
```

Si no, revisa si el servidor est√° activo o si hay bloqueos en la red.

#### Servidor no accesible

Confirma que el servidor Socket.IO est√© en ejecuci√≥n y accesible. Problemas comunes incluyen firewalls o configuraciones de red incorrectas.

#### Versiones incompatibles

Las versiones del cliente y servidor deben ser compatibles. Por ejemplo, un cliente v1/v2 no puede conectar con un servidor v3/v4, devolviendo:

```go:json
{"code":5,"message":"Unsupported protocol version"}
```

**Tabla de compatibilidad (Cliente JS)**:

| Cliente JS | Servidor 1.x | 2.x | 3.x | 4.x |
|------------|--------------|-----ÂΩºÊ≠§|-----|-----|
| 1.x | S√ç ‚úÖ | NO | NO | NO |
| 2.x | NO | S√ç ‚úÖ | S√ç¬π | S√ç¬π |
| 3.x | NO | NO | S√ç ‚úÖ | S√ç ‚úÖ |
| 4.x | NO | NO | S√ç ‚úÖ | S√ç ‚úÖ |

¬π Con `allowEIO3: true`

**Soluci√≥n**: Actualiza el cliente o servidor a versiones compatibles o usa `allowEIO3: true` en el servidor. Consulta la [gu√≠a de compatibilidad](https://socket.io/docs/v4/migrating-from-2-x-to-3-0/).

#### Falta de encabezados CORS

Si ves el error `Cross-Origin Request Blocked`, revisa:

- Si la URL del servidor es correcta.
- Si el servidor tiene CORS habilitado:

```go:js
const io = new Server(httpServer, { cors: { origin: "*" } });
```

Consulta la [gu√≠a de CORS](https://socket.io/docs/v4/handling-cors/).

#### Sesiones pegajosas no habilitadas

En despliegues multi-servidor, aseg√∫rate de que las solicitudes de una misma sesi√≥n lleguen al mismo servidor. Si no, obtendr√°s:

```go:json
{"code":1,"message":"Session ID unknown"}
```

**Soluci√≥n**: Configura sesiones pegajosas. Revisa la [documentaci√≥n de escalado](https://socket.io/docs/v4/using-multiple-nodes/).

#### Ruta de solicitud incorrecta

Aseg√∫rate de que la ruta (`path`) coincida en cliente y servidor. Por defecto, es `/socket.io/`.

**Servidor**:

```go:js
const io = new Server({ path: "/mi-ruta-personalizada/" });
```

**Cliente**:

```go:js
const socket = io(SERVER_URL, { path: "/mi-ruta-personalizada/" });
```

## Problema El socket se desconecta

Las desconexiones son normales debido a:

- Fallos temporales en la red.
- Reinicio del servidor por pol√≠ticas de autoescalado.
- Cambio de red (WiFi a 4G).
- Pesta√±as inactivas en el navegador.

El cliente intenta reconectar autom√°ticamente a menos que se desactive.

### Pasos para diagnosticar

Escucha el evento `disconnect`:

```go:js
socket.on("disconnect", (reason, details) => {
  console.log("Raz√≥n:", reason); // Ejemplo: "transport error"
  console.log("Detalles:", details.message); // Ejemplo: "xhr post error"
  console.log("Descripci√≥n:", details.description); // C√≥digo de estado HTTP
  console.log("Contexto:", details.context); // Objeto XMLHttpRequest
});
```

Consulta las [razones de desconexi√≥n](https://socket.io/docs/v4/client-api/#event-disconnect).

### Posibles causas y soluciones

#### Conexion cerrada por un intermediario

Proxies como Nginx o Apache pueden cerrar conexiones si el tiempo de espera (`proxy_read_timeout` o `ProxyTimeout`, 60s por defecto) es menor que `pingInterval + pingTimeout` (45s por defecto).

**Soluci√≥n**: Aumenta el tiempo de espera del proxy:

```go:nginx
proxy_read_timeout 60s;
```

#### Pesta√±a minimizada y fallo de heartbeat

En Socket.IO v2, los navegadores que limitan temporizadores en pesta√±as inactivas pod√≠an causar desconexiones por _ping timeout_. En v4, el servidor env√≠a los PING, reduciendo este problema.

**Soluci√≥n**: Aumenta `pingTimeout` en el servidor:

```go:js
const io = new Server({ pingTimeout: 60000 });
```

#### Versiones incompatibles

Desconexiones regulares (cada 30s en v2) indican incompatibilidad. Revisa la tabla de compatibilidad anterior.

#### Carga util masiva

Si env√≠as datos grandes, puedes superar `maxHttpBufferSize` (1 MB por defecto) o el _heartbeat_ puede fallar durante la carga.

**Soluci√≥n**: Ajusta los valores:

```go:js
const io = new Server(httpServer, {
  maxHttpBufferSize: 1e8, // 100 MB
  pingTimeout: 60000
});
```

## Problema El socket queda en HTTP long-polling

Si el cliente no pasa a WebSocket, revisa el monitor de red. Deber√≠as ver:

1. Handshake de Engine.IO (contiene el ID de sesi√≥n).
2. Solicitud de handshake de Socket.IO.
3. Respuesta de handshake de Socket.IO (contiene `Socket#id`).
4. Conexi√≥n WebSocket (HTTP 101 Switching Protocols).
5. Solicitud HTTP long-polling (cerrada tras WebSocket).

Si no hay respuesta HTTP 101, algo bloquea la conexi√≥n WebSocket.

### Pasos para diagnosticar

Verifica el transporte actual:

**Cliente**:

```go:js
socket.on("connect", () => {
  console.log("Transporte:", socket.io.engine.transport.name); // Ejemplo: "polling"
  socket.io.engine.on("upgrade", () => {
    console.log("Transporte actualizado:", socket.io.engine.transport.name); // Ejemplo: "websocket"
  });
});
```

**Servidor**:

```go:js
io.on("connection", (socket) => {
  console.log("Transporte:", socket.conn.transport.name); // Ejemplo: "polling"
  socket.conn.on("upgrade", () => {
    console.log("Transporte actualizado:", socket.conn.transport.name); // Ejemplo: "websocket"
  });
});
```

### Posibles causas

#### Proxy no acepta WebSocket

Un proxy mal configurado puede causar un error `TRANSPORT_MISMATCH`:

```go:js
io.engine.on("connection_error", (err) => {
  console.log("C√≥digo:", err.code); // 3
  console.log("Mensaje:", err.message); // "Bad request"
  console.log("Contexto:", err.context); // { name: 'TRANSPORT_MISMATCH', ... }
});
```

**Soluci√≥n**: Configura el proxy para aceptar encabezados WebSocket. Revisa la [gu√≠a de proxies](https://socket.io/docs/v4/using-multiple-nodes/).

#### Interferencia de express-status-monitor

El m√≥dulo `express-status-monitor` usa su propia instance de Socket.IO, causando conflictos.

**Soluci√≥n**: Desactiva `express-status-monitor` o config√∫ralo para evitar conflictos. Consulta la [soluci√≥n espec√≠fica](https://socket.io/docs/v4/troubleshooting/#express-status-monitor-runs-its-own-socketio-instance).

## Otros problemas comunes

### Registro duplicado de eventos

Registra los eventos fuera del listener de `connect`:

**Malo** ‚ö†Ô∏è:

```go:js
socket.on("connect", () => {
  socket.on("foo", () => { /* ... */ });
});
```

**Bueno** üëç:

```go:js
socket.on("connect", () => { /* ... */ });
socket.on("foo", () => { /* ... */ });
```

### Registro tardio de eventos

Evita operaciones as√≠ncronas antes de registrar eventos:

**Malo** ‚ö†Ô∏è:

```go:js
io.on("connection", async (socket) => {
  await operacionLarga();
  socket.on("hola", () => { /* ... */ });
});
```

**Bueno** üëç:

```go:js
io.on("connection", async (socket) => {
  socket.on("hola", () => { /* ... */ });
  await operacionLarga();
});
```

### Uso incorrecto de socket.id

A menos que uses la [recuperaci√≥n de estado](https://socket.io/docs/v4/connection-state-recovery/), evita depender de `socket.id`, ya que:

- Se regenera en cada reconexi√≥n.
- Cada pesta√±a del navegador tiene un ID diferente.
- No hay cola de mensajes para un ID desconectado.

**Soluci√≥n**: Usa un ID de sesi√≥n personalizado (en cookies o `localStorage` con `auth`).

Consulta la [gu√≠a de mensajes privados](https://socket.io/docs/v4/private-messages-part-2/) y [manejo de cookies](https://socket.io/docs/v4/handling-cookies/).

### Despliegue en plataformas serverless

Plataformas como Vercel facturan por duraci√≥n de solicitud, lo que hace que conexiones largas (como Socket.IO o WebSocket) no sean recomendables.

Consulta las gu√≠as para [Vercel](https://vercel.com/guides/do-vercel-serverless-functions-support-websocket-connections) y [AWS API Gateway](https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-websocket-api.html).

## Conclusi√≥n

Resolver problemas de conexi√≥n en Socket.IO requiere diagnosticar errores con eventos como `connect_error` y `disconnect`, verificar configuraciones de CORS, proxies y versiones, y evitar errores comunes como registros duplicados. Con esta gu√≠a, puedes asegurar conexiones estables y optimizar tu aplicaci√≥n en tiempo real.
